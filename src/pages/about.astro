---
import AboutHeroImage from '../assets/blog-placeholder-about.jpg';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { db } from '../lib/db';
import { siteSettings } from '../lib/schema';
import { inArray } from 'drizzle-orm';
import 'bootstrap/dist/css/bootstrap.min.css';
import { Image } from 'astro:assets';

export const prerender = false;

// Fetch about page settings from database
const ABOUT_KEYS = ['about_title', 'about_description', 'about_content', 'about_hero_image'] as const;

let aboutSettings: Record<string, string> = {};
try {
  const settings = await db
    .select()
    .from(siteSettings)
    .where(inArray(siteSettings.key, [...ABOUT_KEYS]));

  for (const setting of settings) {
    aboutSettings[setting.key] = setting.value;
  }
} catch (error) {
  console.error('Failed to load about settings:', error);
}

// Use database values or defaults
const title = aboutSettings.about_title || 'About Me';
const description = aboutSettings.about_description || 'Learn more about me';
const content = aboutSettings.about_content || '';
const heroImageUrl = aboutSettings.about_hero_image || '';

// Determine if we have custom content from the database
const hasCustomContent = !!aboutSettings.about_content;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			main {
				width: calc(100% - 2em);
				max-width: 100%;
				margin: 0;
			}
			.hero-image {
				width: 100%;
			}
			.hero-image img {
				display: block;
				margin: 0 auto;
				border-radius: 12px;
				box-shadow: var(--box-shadow);
			}
			.prose {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;
				color: rgb(var(--gray-dark));
			}
			.title {
				margin-bottom: 1em;
				padding: 1em 0;
				text-align: center;
				line-height: 1;
			}
			.title h1 {
				margin: 0 0 0.5em 0;
			}
			.about-content :global(p) {
				margin-bottom: 1rem;
			}
			.about-content :global(p:last-child) {
				margin-bottom: 0;
			}
		</style>
		<script>
			import "bootstrap/dist/js/bootstrap.bundle.min.js";
		</script>
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="hero-image">
					{heroImageUrl ? (
						<img width="1020" height="510" src={heroImageUrl} alt="" style="max-width: 100%; height: auto;" />
					) : (
						<Image width={1020} height={510} src={AboutHeroImage} alt="" />
					)}
				</div>
				<div class="prose">
					<div class="title">
						<h1>{title}</h1>
						<hr />
					</div>
					<div class="about-content">
						{hasCustomContent ? (
							<Fragment set:html={content} />
						) : (
							<>
								<p>
									Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
									labore et dolore magna aliqua. Vitae ultricies leo integer malesuada nunc vel risus commodo
									viverra. Adipiscing enim eu turpis egestas pretium. Euismod elementum nisi quis eleifend quam
									adipiscing. In hac habitasse platea dictumst vestibulum. Sagittis purus sit amet volutpat. Netus
									et malesuada fames ac turpis egestas. Eget magna fermentum iaculis eu non diam phasellus
									vestibulum lorem. Varius sit amet mattis vulputate enim. Habitasse platea dictumst quisque
									sagittis. Integer quis auctor elit sed vulputate mi. Dictumst quisque sagittis purus sit amet.
								</p>

								<p>
									Morbi tristique senectus et netus. Id semper risus in hendrerit gravida rutrum quisque non
									tellus. Habitasse platea dictumst quisque sagittis purus sit amet. Tellus molestie nunc non
									blandit massa. Cursus vitae congue mauris rhoncus. Accumsan tortor posuere ac ut. Fringilla urna
									porttitor rhoncus dolor. Elit ullamcorper dignissim cras tincidunt lobortis. In cursus turpis
									massa tincidunt dui ut ornare lectus. Integer feugiat scelerisque varius morbi enim nunc.
									Bibendum neque egestas congue quisque egestas diam. Cras ornare arcu dui vivamus arcu felis
									bibendum. Dignissim suspendisse in est ante in nibh mauris. Sed tempus urna et pharetra pharetra
									massa massa ultricies mi.
								</p>

								<p>
									Mollis nunc sed id semper risus in. Convallis a cras semper auctor neque. Diam sit amet nisl
									suscipit. Lacus viverra vitae congue eu consequat ac felis donec. Egestas integer eget aliquet
									nibh praesent tristique magna sit amet. Eget magna fermentum iaculis eu non diam. In vitae
									turpis massa sed elementum. Tristique et egestas quis ipsum suspendisse ultrices. Eget lorem
									dolor sed viverra ipsum. Vel turpis nunc eget lorem dolor sed viverra. Posuere ac ut consequat
									semper viverra nam. Laoreet suspendisse interdum consectetur libero id faucibus. Diam phasellus
									vestibulum lorem sed risus ultricies tristique. Rhoncus dolor purus non enim praesent elementum
									facilisis. Ultrices tincidunt arcu non sodales neque. Tempus egestas sed sed risus pretium quam
									vulputate. Viverra suspendisse potenti nullam ac tortor vitae purus faucibus ornare. Fringilla
									urna porttitor rhoncus dolor purus non. Amet dictum sit amet justo donec enim.
								</p>

								<p>
									Mattis ullamcorper velit sed ullamcorper morbi tincidunt. Tortor posuere ac ut consequat semper
									viverra. Tellus mauris a diam maecenas sed enim ut sem viverra. Venenatis urna cursus eget nunc
									scelerisque viverra mauris in. Arcu ac tortor dignissim convallis aenean et tortor at. Curabitur
									gravida arcu ac tortor dignissim convallis aenean et tortor. Egestas tellus rutrum tellus
									pellentesque eu. Fusce ut placerat orci nulla pellentesque dignissim enim sit amet. Ut enim
									blandit volutpat maecenas volutpat blandit aliquam etiam. Id donec ultrices tincidunt arcu. Id
									cursus metus aliquam eleifend mi.
								</p>

								<p>
									Tempus quam pellentesque nec nam aliquam sem. Risus at ultrices mi tempus imperdiet. Id porta
									nibh venenatis cras sed felis eget velit. Ipsum a arcu cursus vitae. Facilisis magna etiam
									tempor orci eu lobortis elementum. Tincidunt dui ut ornare lectus sit. Quisque non tellus orci
									ac. Blandit libero volutpat sed cras. Nec tincidunt praesent semper feugiat nibh sed pulvinar
									proin gravida. Egestas integer eget aliquet nibh praesent tristique magna.
								</p>
							</>
						)}
					</div>
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
